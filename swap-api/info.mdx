
# SDK for swap.coffee DEX aggregator

## Installation

For JavaScript/TypeScript please use the SDK as stated below:

```bash
npm install @swap-coffee/sdk
```

For any other languages, you can integrate with our Rest API.

## Concepts

Here are some basic concepts you need to know to work with our SDK:

- **Asset**: A token on a blockchain. It can be a native token (like TON on TON blockchain) or a jetton (like USDT on TON blockchain). Each asset has a unique address on the blockchain.
- **Route**: A set of paths.
- **Path**: A list of tokens (or liquidity pools) that can be swapped one to another.
- **Price impact**: The change in the token's price when performing a swap, depending on the swap amount and the token's liquidity.
- **Price slippage**: The change in token price over time. A transaction will fail if the slippage tolerance is exceeded.
- **Transaction**: A set of messages sent to the blockchain, such as token transfers or contract calls.

## How the DEX aggregator works

1. You provide the input token, output token, and the amount to swap.
2. We build the optimal route, splitting the input token between several liquidity pools to reduce price impact.
3. We build the transactions that will swap the tokens.
4. You send the transactions to the blockchain.
5. If slippage tolerance is exceeded, the transaction is reverted.
6. You receive the output token in your wallet.

## Basic usage

Swapping assets using our SDK and TonConnect SDK:

```typescript
import {ApiTokenAddress, RoutingApi} from "@swap-coffee/sdk";
import TonConnect, {WalletInfo, WalletInfoRemote} from "@tonconnect/sdk";

const connector = await setupTonConnect()
const routingApi = new RoutingApi()

const assetIn: ApiTokenAddress = {
    blockchain: "ton",
    address: "native"
}
const assetOut: ApiTokenAddress = {
    blockchain: "ton",
    address: "EQCl0S4xvoeGeFGijTzicSA8j6GiiugmJW5zxQbZTUntre-1"
}

const input_amount = 5 // 5 TON

const route = await routingApi.buildRoute({
    input_token: assetIn,
    output_token: assetOut,
    input_amount: input_amount,
})

const transactions = await routingApi.buildTransactionsV2({
    sender_address: connector.account?.address!!,
    slippage: 0.1,
    paths: route.data.paths,
})

let messages = []

for (const transaction of transactions.data.transactions) {
    messages.push({
        address: transaction.address,
        amount: transaction.value,
        payload: transaction.cell,
    })
}

await connector.sendTransaction({
    validUntil: Date.now() + 5 * 60 * 1000,
    messages: messages,
})
```

## Advanced usage

Additional settings can be configured for more control over route building, such as:

- **max_length**: Maximum path length in tokens (default: 3).
- **max_splits**: Maximum number of splits (default: 4).
- **pool_selector**: Controls which liquidity pools can be used.

```typescript
const route = await routingApi.buildRoute({
    input_token: assetIn,
    output_token: assetOut,
    input_amount: input_amount,
    max_length: 4,
    max_splits: 2,
    pool_selector: {
        max_volatility: 2.2,
    },
});
```

## ExactOut swaps

Specify `output_amount` for exact output swaps:

```typescript
const route = await routingApi.buildRoute({
    input_token: assetIn,
    output_token: assetOut,
    output_amount: 200,
});
```

## Checking transaction results

Use the `route_id` to check the status of route transactions on the blockchain.

```typescript
import {ApiTokenAddress, RoutingApi, waitForTransactionResults} from "@swap-coffee/sdk";

const connector = await setupTonConnect();
const routingApi = new RoutingApi();

const assetIn: ApiTokenAddress = {
  blockchain: 'ton',
  address: 'native',
};
const assetOut: ApiTokenAddress = {
  blockchain: 'ton',
  address: 'EQCl0S4xvoeGeFGijTzicSA8j6GiiugmJW5zxQbZTUntre-1',
};

const route = await routingApi.buildRoute({
  input_token: assetIn,
  output_token: assetOut,
  input_amount: 5,
});

const transactions = await routingApi.buildTransactionsV2({
  sender_address: connector.account?.address!!,
  slippage: 0.1,
  paths: route.data.paths,
});

await connector.sendTransaction({
  validUntil: Date.now() + 5 * 60 * 1000,
  messages: messages,
});

const results = await waitForTransactionResults(transactions.data.route_id, routingApi);

for (const result of results) {
  // handle result for each route's paths
}
```

## API Limitations

- `input_token` and `output_token` must be different.
- The average load should not exceed 1 request per second per IP.
- All commission from transactions goes to swap.coffee.
